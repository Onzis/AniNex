<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AniNex - Лучшие аниме онлайн</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Кастомные стили -->
    <style>
        :root {
            --primary-color: #9333ea;
            --secondary-color: #ec4899;
            --bg-dark: #111827;
            --bg-medium: #1f2937;
            --bg-light: #374151;
            --text-primary: #ffffff;
            --text-secondary: #9ca3af;
        }
        
        * {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background-color: var(--bg-dark);
            color: var(--text-primary);
            line-height: 1.6;
        }
        
        /* Навигация */
        .nav-container {
            background-color: var(--bg-medium);
            position: sticky;
            top: 0;
            z-index: 50;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .nav-content {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 1rem;
        }
        
        .nav-flex {
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 4rem;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
            color: var(--text-primary);
        }
        
        .logo-icon {
            color: var(--primary-color);
            font-size: 1.875rem;
        }
        
        .logo-text {
            font-size: 1.25rem;
            font-weight: 700;
        }
        
        .nav-menu {
            display: none;
            align-items: center;
            gap: 1.5rem;
        }
        
        .nav-menu a {
            color: var(--text-primary);
            text-decoration: none;
            transition: color 0.2s ease;
        }
        
        .nav-menu a:hover {
            color: var(--primary-color);
        }
        
        .nav-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .nav-btn {
            background: none;
            border: none;
            color: var(--text-primary);
            cursor: pointer;
            transition: color 0.2s ease;
            font-size: 1.25rem;
        }
        
        .nav-btn:hover {
            color: var(--primary-color);
        }
        
        .mobile-menu-btn {
            display: block;
        }
        
        /* Мобильное меню */
        .mobile-menu {
            position: fixed;
            top: 4rem;
            left: 0;
            width: 16rem;
            height: calc(100vh - 4rem);
            background-color: var(--bg-medium);
            box-shadow: 4px 0 6px -1px rgba(0, 0, 0, 0.1);
            transform: translateX(-100%);
            transition: transform 0.3s ease;
            z-index: 40;
        }
        
        .mobile-menu.active {
            transform: translateX(0);
        }
        
        .mobile-menu-content {
            padding: 1rem;
        }
        
        .mobile-menu a {
            display: block;
            padding: 0.5rem 0;
            color: var(--text-primary);
            text-decoration: none;
            transition: color 0.2s ease;
        }
        
        .mobile-menu a:hover {
            color: var(--primary-color);
        }
        
        /* Поиск */
        .search-panel {
            position: fixed;
            top: 4rem;
            left: 0;
            width: 100%;
            background-color: var(--bg-medium);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            z-index: 40;
            padding: 1rem;
            display: none;
        }
        
        .search-panel.active {
            display: block;
        }
        
        .search-container {
            max-width: 1280px;
            margin: 0 auto;
            position: relative;
        }
        
        .search-input {
            width: 100%;
            background-color: var(--bg-light);
            color: var(--text-primary);
            padding: 0.5rem 1rem;
            padding-right: 2.5rem;
            border: none;
            border-radius: 0.5rem;
            outline: none;
        }
        
        .search-input:focus {
            ring: 2px solid var(--primary-color);
        }
        
        .search-btn {
            position: absolute;
            right: 0.5rem;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 0.25rem;
        }
        
        .search-btn:hover {
            color: var(--text-primary);
        }
        
        /* Выпадающий список поиска */
        .search-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            background-color: var(--bg-medium);
            border-radius: 0.5rem;
            margin-top: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            max-height: 300px;
            overflow-y: auto;
            z-index: 50;
            display: none;
        }
        
        .search-dropdown.active {
            display: block;
        }
        
        .search-dropdown-item {
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: background-color 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .search-dropdown-item:hover {
            background-color: var(--bg-light);
        }
        
        .search-dropdown-item img {
            width: 40px;
            height: 60px;
            object-fit: cover;
            border-radius: 0.25rem;
        }
        
        .search-dropdown-item-info {
            flex: 1;
        }
        
        .search-dropdown-item-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        
        .search-dropdown-item-meta {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }
        
        /* Баннер */
        .hero-section {
            position: relative;
            height: 24rem;
            overflow: hidden;
        }
        
        .hero-bg {
            position: absolute;
            inset: 0;
        }
        
        .hero-bg img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .hero-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(to bottom, transparent 0%, rgba(0,0,0,0.8) 100%);
        }
        
        .hero-content {
            position: relative;
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 1rem;
            height: 100%;
            display: flex;
            align-items: center;
        }
        
        .hero-text {
            max-width: 42rem;
        }
        
        .hero-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            line-height: 1.2;
        }
        
        .hero-description {
            font-size: 1.125rem;
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
        }
        
        .hero-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: background-color 0.2s ease;
        }
        
        .btn-primary:hover {
            background-color: #7c3aed;
        }
        
        .btn-secondary {
            background-color: var(--bg-light);
            color: var(--text-primary);
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: background-color 0.2s ease;
        }
        
        .btn-secondary:hover {
            background-color: #4b5563;
        }
        
        /* Секции */
        .section {
            max-width: 1280px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }
        
        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }
        
        .section-title {
            font-size: 1.875rem;
            font-weight: 700;
        }
        
        .section-link {
            color: var(--primary-color);
            text-decoration: none;
            transition: color 0.2s ease;
        }
        
        .section-link:hover {
            color: #a855f7;
        }
        
        /* Карточки аниме */
        .anime-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }
        
        .anime-card {
            background-color: var(--bg-medium);
            border-radius: 0.5rem;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .anime-card:hover {
            transform: translateY(-0.25rem);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .anime-card-image {
            position: relative;
            overflow: hidden;
        }
        
        .anime-card-image img {
            width: 100%;
            height: 10rem;
            object-fit: cover;
            transition: transform 0.3s ease;
        }
        
        .anime-card:hover .anime-card-image img {
            transform: scale(1.05);
        }
        
        .anime-badge {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background-color: #dc2626;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .anime-card-content {
            padding: 0.75rem;
        }
        
        .anime-card-title {
            font-weight: 600;
            font-size: 0.875rem;
            margin-bottom: 0.25rem;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .anime-card-episode {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }
        
        /* Популярные аниме */
        .popular-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1.5rem;
        }
        
        .popular-card {
            background-color: var(--bg-medium);
            border-radius: 0.5rem;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
        }
        
        .popular-card:hover {
            transform: translateY(-0.25rem);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .popular-card-image {
            position: relative;
            overflow: hidden;
        }
        
        .popular-card-image img {
            width: 100%;
            height: 12rem;
            object-fit: cover;
        }
        
        .play-overlay {
            position: absolute;
            inset: 0;
            background-color: rgba(0, 0, 0, 0);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s ease;
        }
        
        .popular-card:hover .play-overlay {
            background-color: rgba(0, 0, 0, 0.5);
        }
        
        .play-icon {
            font-size: 3rem;
            color: white;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .popular-card:hover .play-icon {
            opacity: 1;
        }
        
        .rating-badge {
            position: absolute;
            bottom: 0.5rem;
            left: 0.5rem;
            background-color: var(--primary-color);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .popular-card-content {
            padding: 1rem;
        }
        
        .popular-card-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .genre-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }
        
        .genre-tag {
            background-color: var(--bg-light);
            color: var(--text-secondary);
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
        }
        
        .popular-card-description {
            font-size: 0.875rem;
            color: var(--text-secondary);
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        /* Фильтры */
        .filter-buttons {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            background-color: var(--primary-color);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        
        .filter-btn:hover {
            background-color: #7c3aed;
        }
        
        .filter-btn.secondary {
            background-color: var(--bg-light);
            color: var(--text-primary);
        }
        
        .filter-btn.secondary:hover {
            background-color: #4b5563;
        }
        
        .filter-btn.active {
            background-color: var(--primary-color);
        }
        
        /* Футер */
        .footer {
            background-color: var(--bg-medium);
            margin-top: 4rem;
            padding: 3rem 0;
        }
        
        .footer-content {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 1rem;
        }
        
        .footer-grid {
            display: grid;
            grid-template-columns: repeat(1, 1fr);
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        .footer-logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .footer-logo-icon {
            color: var(--primary-color);
            font-size: 1.875rem;
        }
        
        .footer-logo-text {
            font-size: 1.25rem;
            font-weight: 700;
        }
        
        .footer-description {
            color: var(--text-secondary);
        }
        
        .footer-links h4 {
            font-weight: 600;
            margin-bottom: 1rem;
        }
        
        .footer-links ul {
            list-style: none;
        }
        
        .footer-links li {
            margin-bottom: 0.5rem;
        }
        
        .footer-links a {
            color: var(--text-secondary);
            text-decoration: none;
            transition: color 0.2s ease;
        }
        
        .footer-links a:hover {
            color: var(--text-primary);
        }
        
        .social-links {
            display: flex;
            gap: 1rem;
        }
        
        .social-links a {
            color: var(--text-secondary);
            font-size: 1.5rem;
            transition: color 0.2s ease;
        }
        
        .social-links a:hover {
            color: var(--text-primary);
        }
        
        .footer-bottom {
            border-top: 1px solid var(--bg-light);
            padding-top: 2rem;
            text-align: center;
            color: var(--text-secondary);
        }
        
        /* Индикатор загрузки */
        .loader {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
        }
        
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top: 4px solid var(--primary-color);
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Пагинация */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
            margin-top: 2rem;
        }
        
        .pagination-btn {
            background-color: var(--bg-light);
            color: var(--text-primary);
            border: none;
            padding: 0.5rem 0.75rem;
            border-radius: 0.25rem;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        
        .pagination-btn:hover {
            background-color: #4b5563;
        }
        
        .pagination-btn.active {
            background-color: var(--primary-color);
        }
        
        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Сообщение об ошибке */
        .error-message {
            background-color: rgba(220, 38, 38, 0.2);
            border-left: 4px solid #dc2626;
            padding: 1rem;
            border-radius: 0.25rem;
            margin-bottom: 1rem;
            display: none;
        }
        
        .error-message.show {
            display: block;
        }
        
        /* Кнопка повторной попытки */
        .retry-button {
            background-color: var(--primary-color);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s ease;
            margin-top: 1rem;
            display: inline-block;
        }
        
        .retry-button:hover {
            background-color: #7c3aed;
        }
        
        /* Детальная страница аниме */
        .anime-detail {
            max-width: 1280px;
            margin: 0 auto;
            padding: 2rem 1rem;
            display: none;
        }
        
        .anime-detail.active {
            display: block;
        }
        
        .anime-detail-header {
            display: flex;
            flex-direction: column;
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        .anime-detail-image {
            width: 100%;
            height: 20rem;
            object-fit: cover;
            border-radius: 0.5rem;
        }
        
        .anime-detail-info {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .anime-detail-title {
            font-size: 2rem;
            font-weight: 700;
        }
        
        .anime-detail-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .anime-detail-meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .anime-detail-meta-label {
            color: var(--text-secondary);
        }
        
        .anime-detail-description {
            line-height: 1.8;
            color: var(--text-secondary);
        }
        
        .anime-detail-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .anime-detail-section {
            margin-top: 2rem;
        }
        
        .anime-detail-section-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }
        
        .anime-detail-genres {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        
        .anime-detail-genre {
            background-color: var(--bg-light);
            color: var(--text-primary);
            padding: 0.5rem 1rem;
            border-radius: 0.25rem;
        }
        
        /* Карусель скриншотов */
        .anime-detail-screenshots-container {
            position: relative;
            overflow: hidden;
            border-radius: 0.5rem;
            margin-top: 1rem;
        }
        
        .anime-detail-screenshots {
            display: flex;
            transition: transform 0.3s ease;
        }
        
        .screenshot-slide {
            min-width: 100%;
            display: flex;
            flex-direction: row;
            gap: 0.5rem;
            padding: 0.5rem;
        }
        
        .anime-detail-screenshot {
            flex: 1;
            height: 150px;
            object-fit: cover;
            border-radius: 0.25rem;
            transition: transform 0.2s ease;
        }
        
        .anime-detail-screenshot:hover {
            transform: scale(1.05);
        }
        
        .screenshot-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 10;
            transition: background-color 0.2s ease;
        }
        
        .screenshot-nav:hover {
            background-color: rgba(0, 0, 0, 0.8);
        }
        
        .screenshot-nav.prev {
            left: 10px;
        }
        
        .screenshot-nav.next {
            right: 10px;
        }
        
        .screenshot-indicators {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }
        
        .screenshot-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: var(--bg-light);
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        
        .screenshot-indicator.active {
            background-color: var(--primary-color);
        }
        
        /* Плееры для просмотра аниме */
        .anime-players {
            margin-top: 2rem;
        }
        
        .players-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            border-bottom: 1px solid var(--bg-light);
        }
        
        .player-tab {
            padding: 0.75rem 1rem;
            background: none;
            border: none;
            color: var(--text-secondary);
            font-weight: 600;
            cursor: pointer;
            transition: color 0.2s ease, border-bottom 0.2s ease;
            border-bottom: 2px solid transparent;
        }
        
        .player-tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }
        
        .player-content {
            background-color: var(--bg-medium);
            border-radius: 0.5rem;
            overflow: hidden;
            min-height: 400px;
            position: relative;
        }
        
        .player-frame {
            display: none;
            width: 100%;
            height: 400px;
            background-color: var(--bg-light);
            border-radius: 0.5rem;
            overflow: hidden;
        }
        
        .player-frame.active {
            display: block;
        }
        
        .player-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            padding: 2rem;
            text-align: center;
        }
        
        .player-placeholder-icon {
            font-size: 4rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }
        
        .player-placeholder-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .player-placeholder-description {
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
        }
        
        .player-token {
            background-color: var(--bg-light);
            padding: 0.5rem 1rem;
            border-radius: 0.25rem;
            font-family: monospace;
            font-size: 0.875rem;
            margin-bottom: 1rem;
        }
        
        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--primary-color);
            text-decoration: none;
            margin-bottom: 1rem;
            transition: color 0.2s ease;
        }
        
        .back-button:hover {
            color: #a855f7;
        }
        
        /* Адаптивность */
        @media (min-width: 640px) {
            .anime-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .popular-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .footer-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .anime-detail-header {
                flex-direction: row;
            }
            
            .anime-detail-image {
                width: 30%;
                height: auto;
            }
            
            .anime-detail-info {
                width: 70%;
            }
        }
        
        @media (min-width: 768px) {
            .nav-menu {
                display: flex;
            }
            
            .mobile-menu-btn {
                display: none;
            }
            
            .hero-title {
                font-size: 3rem;
            }
            
            .anime-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .footer-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        @media (min-width: 1024px) {
            .anime-grid {
                grid-template-columns: repeat(6, 1fr);
            }
            
            .popular-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        /* Анимации */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(1.25rem);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }
    </style>
</head>
<body>
    <!-- Навигация -->
    <nav class="nav-container">
        <div class="nav-content">
            <div class="nav-flex">
                <!-- Логотип -->
                <div class="flex items-center">
                    <button class="mobile-menu-btn nav-btn" onclick="toggleMobileMenu()">
                        <i class="fas fa-bars"></i>
                    </button>
                    <a href="#" class="logo" onclick="showHomePage()">
                        <i class="fas fa-play-circle logo-icon"></i>
                        <span class="logo-text">AniNex</span>
                    </a>
                </div>
                
                <!-- Десктопное меню -->
                <div class="nav-menu">
                    <a href="#" onclick="showHomePage()">Главная</a>
                    <a href="#" onclick="showAllAnimes()">Аниме</a>
                </div>
                
                <!-- Поиск и профиль -->
                <div class="nav-actions">
                    <button class="nav-btn" onclick="toggleSearch()">
                        <i class="fas fa-search"></i>
                    </button>
                    <button class="nav-btn">
                        <i class="fas fa-user-circle"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Мобильное меню -->
        <div class="mobile-menu" id="mobileMenu">
            <div class="mobile-menu-content">
                <a href="#" onclick="showHomePage()">Главная</a>
                <a href="#" onclick="showAllAnimes()">Аниме</a>
            </div>
        </div>
    </nav>
    
    <!-- Поиск -->
    <div class="search-panel" id="searchPanel">
        <div class="search-container">
            <input type="text" placeholder="Поиск аниме..." class="search-input" id="searchInput" oninput="handleSearchInput(this.value)">
            <button class="search-btn" onclick="performSearch()">
                <i class="fas fa-search"></i>
            </button>
            
            <!-- Выпадающий список результатов поиска -->
            <div class="search-dropdown" id="searchDropdown">
                <!-- Результаты поиска будут добавлены динамически -->
            </div>
        </div>
    </div>
    
    <!-- Главная страница -->
    <div id="homePage">
        <!-- Главный баннер -->
        <section class="hero-section">
            <div class="hero-bg">
                <img src="https://picsum.photos/seed/anime-banner/1920/500" alt="Featured Anime">
                <div class="hero-overlay"></div>
            </div>
            <div class="hero-content">
                <div class="hero-text fade-in">
                    <h1 class="hero-title">Аниме портал с Shikimori API</h1>
                    <p class="hero-description">Лучшие аниме с рейтингом и описанием</p>
                    <div class="hero-buttons">
                        <a href="#" class="btn-primary">
                            <i class="fas fa-play"></i>
                            Смотреть
                        </a>
                        <a href="#" class="btn-secondary">
                            <i class="fas fa-info-circle"></i>
                            Подробнее
                        </a>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Аниме -->
        <section class="section">
            <div class="section-header">
                <h2 class="section-title">Аниме</h2>
                <div class="filter-buttons">
                    <button class="filter-btn active" onclick="filterAnimes('all')">Все</button>
                    <button class="filter-btn secondary" onclick="filterAnimes('ongoing')">Онгоинги</button>
                    <button class="filter-btn secondary" onclick="filterAnimes('released')">Завершенные</button>
                </div>
            </div>
            
            <div class="error-message" id="errorMessage">
                Не удалось загрузить данные. Пожалуйста, попробуйте позже.
                <button class="retry-button" onclick="retryLoading()">Попробовать снова</button>
            </div>
            
            <div class="loader" id="popularLoader">
                <div class="spinner"></div>
            </div>
            
            <div class="popular-grid" id="popularAnimesGrid">
                <!-- Карточки будут загружены через API -->
            </div>
            
            <div class="pagination" id="pagination">
                <!-- Кнопки пагинации будут добавлены динамически -->
            </div>
        </section>
    </div>
    
    <!-- Страница всех аниме -->
    <div id="allAnimesPage" style="display: none;">
        <section class="section">
            <div class="section-header">
                <h2 class="section-title">Все аниме</h2>
                <div class="filter-buttons">
                    <button class="filter-btn active" onclick="filterAllAnimes('all')">Все</button>
                    <button class="filter-btn secondary" onclick="filterAllAnimes('ongoing')">Онгоинги</button>
                    <button class="filter-btn secondary" onclick="filterAllAnimes('released')">Завершенные</button>
                </div>
            </div>
            
            <div class="error-message" id="allAnimesErrorMessage">
                Не удалось загрузить данные. Пожалуйста, попробуйте позже.
                <button class="retry-button" onclick="retryAllAnimesLoading()">Попробовать снова</button>
            </div>
            
            <div class="loader" id="allAnimesLoader">
                <div class="spinner"></div>
            </div>
            
            <div class="popular-grid" id="allAnimesGrid">
                <!-- Карточки будут загружены через API -->
            </div>
            
            <div class="pagination" id="allAnimesPagination">
                <!-- Кнопки пагинации будут добавлены динамически -->
            </div>
        </section>
    </div>
    
    <!-- Детальная страница аниме -->
    <div id="animeDetailPage" class="anime-detail">
        <a href="#" class="back-button" onclick="showHomePage()">
            <i class="fas fa-arrow-left"></i>
            Вернуться на главную
        </a>
        
        <div class="anime-detail-header">
            <img id="animeDetailImage" src="" alt="Anime" class="anime-detail-image">
            <div class="anime-detail-info">
                <h1 id="animeDetailTitle" class="anime-detail-title">Название аниме</h1>
                <div class="anime-detail-meta">
                    <div class="anime-detail-meta-item">
                        <span class="anime-detail-meta-label">Год:</span>
                        <span id="animeDetailYear">2023</span>
                    </div>
                    <div class="anime-detail-meta-item">
                        <span class="anime-detail-meta-label">Серии:</span>
                        <span id="animeDetailEpisodes">24</span>
                    </div>
                    <div class="anime-detail-meta-item">
                        <span class="anime-detail-meta-label">Статус:</span>
                        <span id="animeDetailStatus">Онгоинг</span>
                    </div>
                    <div class="anime-detail-meta-item">
                        <span class="anime-detail-meta-label">Рейтинг:</span>
                        <span id="animeDetailScore">9.2</span>
                    </div>
                </div>
                <p id="animeDetailDescription" class="anime-detail-description">
                    Описание аниме...
                </p>
                <div class="anime-detail-actions">
                    <button class="btn-primary">
                        <i class="fas fa-play"></i>
                        Смотреть 1 серию
                    </button>
                    <button class="btn-secondary">
                        <i class="fas fa-heart"></i>
                        В избранное
                    </button>
                </div>
            </div>
        </div>
        
        <div class="anime-detail-section">
            <h2 class="anime-detail-section-title">Жанры</h2>
            <div class="anime-detail-genres" id="animeDetailGenres">
                <!-- Жанры будут добавлены динамически -->
            </div>
        </div>
        
        <div class="anime-detail-section">
            <h2 class="anime-detail-section-title">Студия</h2>
            <p id="animeDetailStudio">MAPPA</p>
        </div>
        
        <div class="anime-detail-section">
            <h2 class="anime-detail-section-title">Скриншоты</h2>
            <div class="anime-detail-screenshots-container">
                <div class="anime-detail-screenshots" id="animeDetailScreenshots">
                    <!-- Скриншоты будут добавлены динамически -->
                </div>
                <button class="screenshot-nav prev" onclick="changeScreenshot(-1)">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <button class="screenshot-nav next" onclick="changeScreenshot(1)">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
            <div class="screenshot-indicators" id="screenshotIndicators">
                <!-- Индикаторы будут добавлены динамически -->
            </div>
        </div>
        
        <!-- Плееры для просмотра аниме -->
        <div class="anime-detail-section">
            <h2 class="anime-detail-section-title">Плееры для просмотра аниме</h2>
            <div class="anime-players">
                <div class="players-tabs">
                    <button class="player-tab active" onclick="switchPlayer('kodik')">Kodik</button>
                    <button class="player-tab" onclick="switchPlayer('alloha')">Alloha</button>
                </div>
                
                <div class="player-content">
                    <!-- Плеер Kodik -->
                    <div id="kodik-player" class="player-frame active">
                        <div class="player-placeholder">
                            <i class="fas fa-play-circle player-placeholder-icon"></i>
                            <h3 class="player-placeholder-title">Kodik Player</h3>
                            <p class="player-placeholder-description">
                                Плеер для просмотра аниме с высоким качеством видео
                            </p>
                            <div class="player-token">Токен: 447d179e875efe44217f20d1ee2146be</div>
                            <button class="btn-primary" onclick="initKodikPlayer()">
                                <i class="fas fa-play"></i>
                                Инициализировать плеер
                            </button>
                        </div>
                    </div>
                    
                    <!-- Плеер Alloha -->
                    <div id="alloha-player" class="player-frame">
                        <div class="player-placeholder">
                            <i class="fas fa-play-circle player-placeholder-icon"></i>
                            <h3 class="player-placeholder-title">Alloha Player</h3>
                            <p class="player-placeholder-description">
                                Альтернативный плеер для просмотра аниме
                            </p>
                            <div class="player-token">Токен: 96b62ea8e72e7452b652e461ab8b89</div>
                            <button class="btn-primary" onclick="initAllohaPlayer()">
                                <i class="fas fa-play"></i>
                                Инициализировать плеер
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Футер -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-grid">
                <div>
                    <div class="footer-logo">
                        <i class="fas fa-play-circle footer-logo-icon"></i>
                        <span class="footer-logo-text">AniNex</span>
                    </div>
                    <p class="footer-description">Лучший портал для просмотра аниме онлайн</p>
                </div>
                
                <div class="footer-links">
                    <h4>Навигация</h4>
                    <ul>
                        <li><a href="#" onclick="showHomePage()">Главная</a></li>
                        <li><a href="#" onclick="showAllAnimes()">Аниме</a></li>
                    </ul>
                </div>
                
                <div class="footer-links">
                    <h4>Полезное</h4>
                    <ul>
                        <li><a href="#">Помощь</a></li>
                    </ul>
                </div>
                
                <div>
                    <h4>Соцсети</h4>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-vk"></i></a>
                        <a href="#"><i class="fab fa-telegram"></i></a>
                        <a href="#"><i class="fab fa-discord"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                    </div>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2024 AniNex. Все права защищены. Данные предоставлены Shikimori API.</p>
            </div>
        </div>
    </footer>
    
    <script>
        // Глобальные переменные
        let currentPage = 1;
        let currentFilter = 'all';
        let currentGenre = null;
        let totalPages = 1;
        let allAnimes = [];
        let retryCount = 0;
        const MAX_RETRIES = 3;
        
        // Переменные для страницы всех аниме
        let allAnimesCurrentPage = 1;
        let allAnimesCurrentFilter = 'all';
        let allAnimesTotalPages = 1;
        
        // Переменные для скриншотов
        let currentScreenshotIndex = 0;
        let totalScreenshotGroups = 0;
        let isDragging = false;
        let startX = 0;
        let currentX = 0;
        
        // Переменные для поиска
        let searchTimeout;
        let searchResults = [];
        
        // Переменные для плееров
        let currentAnimeId = null;
        
        // Токены для плееров
        const KodikToken = "447d179e875efe44217f20d1ee2146be";
        const AllohaToken = "96b62ea8e72e7452b652e461ab8b89";
        
        // Конфигурация API
        const API_BASE_URL = 'https://shikimori.one/api';
        const SHIKIMORI_BASE_URL = 'https://shikimori.one';
        
        // Список прокси-серверов для обхода CORS
        const PROXY_SERVERS = [
            'https://cors-anywhere.herokuapp.com/',
            'https://api.codetabs.com/v1/proxy?quest=',
            'https://corsproxy.io/?',
            'https://thingproxy.freeboard.io/fetch/'
        ];
        
        let currentProxyIndex = 0;
        
        // Мобильное меню
        function toggleMobileMenu() {
            const menu = document.getElementById('mobileMenu');
            menu.classList.toggle('active');
        }
        
        // Поиск
        function toggleSearch() {
            const searchPanel = document.getElementById('searchPanel');
            searchPanel.classList.toggle('active');
            if (searchPanel.classList.contains('active')) {
                document.getElementById('searchInput').focus();
            }
        }
        
        // Обработка ввода в поле поиска
        function handleSearchInput(searchTerm) {
            clearTimeout(searchTimeout);
            
            if (searchTerm.trim() === '') {
                document.getElementById('searchDropdown').classList.remove('active');
                return;
            }
            
            searchTimeout = setTimeout(() => {
                searchAnimesForDropdown(searchTerm);
            }, 300);
        }
        
        // Поиск аниме для выпадающего списка
        async function searchAnimesForDropdown(searchTerm) {
            const dropdown = document.getElementById('searchDropdown');
            
            if (searchTerm.trim() === '') {
                dropdown.classList.remove('active');
                return;
            }
            
            try {
                let apiUrl = `${API_BASE_URL}/animes?limit=10&search=${encodeURIComponent(searchTerm)}`;
                let data = null;
                
                // Попытка загрузки с разными прокси
                for (let i = 0; i < PROXY_SERVERS.length; i++) {
                    try {
                        const proxy = PROXY_SERVERS[i];
                        const url = `${proxy}${encodeURIComponent(apiUrl)}`;
                        
                        const response = await fetch(url, {
                            headers: {
                                'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36'
                            }
                        });
                        
                        if (response.ok) {
                            data = await response.json();
                            break;
                        }
                    } catch (error) {
                        console.warn(`Прокси ${PROXY_SERVERS[i]} не сработал:`, error);
                    }
                }
                
                if (data) {
                    searchResults = data;
                    renderSearchDropdown(data);
                } else {
                    throw new Error('Не удалось загрузить данные');
                }
                
            } catch (error) {
                console.error('Ошибка при поиске аниме для выпадающего списка:', error);
                dropdown.innerHTML = '<div class="search-dropdown-item">Не удалось загрузить результаты</div>';
                dropdown.classList.add('active');
            }
        }
        
        // Отображение выпадающего списка поиска
        function renderSearchDropdown(animes) {
            const dropdown = document.getElementById('searchDropdown');
            dropdown.innerHTML = '';
            
            if (!animes || animes.length === 0) {
                dropdown.innerHTML = '<div class="search-dropdown-item">Ничего не найдено</div>';
                dropdown.classList.add('active');
                return;
            }
            
            animes.forEach(anime => {
                const item = document.createElement('div');
                item.className = 'search-dropdown-item';
                item.onclick = () => {
                    showAnimeDetail(anime.id);
                    document.getElementById('searchPanel').classList.remove('active');
                    document.getElementById('searchInput').value = '';
                    dropdown.classList.remove('active');
                };
                
                const imageUrl = anime.image ? `${SHIKIMORI_BASE_URL}${anime.image.original}` : 'https://picsum.photos/seed/anime-placeholder/40/60';
                
                item.innerHTML = `
                    <img src="${imageUrl}" alt="${anime.russian || anime.name}" onerror="this.src='https://picsum.photos/seed/anime-error/40/60'">
                    <div class="search-dropdown-item-info">
                        <div class="search-dropdown-item-title">${anime.russian || anime.name}</div>
                        <div class="search-dropdown-item-meta">${anime.episodes || anime.episodes_aired || '?'} серий • ${anime.score || 'N/A'} ★</div>
                    </div>
                `;
                
                dropdown.appendChild(item);
            });
            
            dropdown.classList.add('active');
        }
        
        // Выполнить поиск
        function performSearch() {
            const searchTerm = document.getElementById('searchInput').value.trim();
            if (searchTerm) {
                searchAnimes(searchTerm);
            }
        }
        
        // Показать главную страницу
        function showHomePage() {
            document.getElementById('homePage').style.display = 'block';
            document.getElementById('allAnimesPage').style.display = 'none';
            document.getElementById('animeDetailPage').classList.remove('active');
            window.scrollTo(0, 0);
        }
        
        // Показать страницу всех аниме
        function showAllAnimes() {
            document.getElementById('homePage').style.display = 'none';
            document.getElementById('allAnimesPage').style.display = 'block';
            document.getElementById('animeDetailPage').classList.remove('active');
            
            // Загрузка всех аниме, если еще не загружены
            if (document.getElementById('allAnimesGrid').children.length === 0) {
                loadAllAnimes();
            }
            
            window.scrollTo(0, 0);
        }
        
        // Показать детальную страницу аниме
        function showAnimeDetail(animeId) {
            document.getElementById('homePage').style.display = 'none';
            document.getElementById('allAnimesPage').style.display = 'none';
            document.getElementById('animeDetailPage').classList.add('active');
            
            // Сохраняем ID текущего аниме
            currentAnimeId = animeId;
            
            // Загрузка деталей аниме
            loadAnimeDetails(animeId);
            
            window.scrollTo(0, 0);
        }
        
        // Закрытие поиска при клике вне его
        document.addEventListener('click', function(e) {
            const searchPanel = document.getElementById('searchPanel');
            const searchButton = e.target.closest('button');
            const searchDropdown = document.getElementById('searchDropdown');
            
            if (!searchPanel.contains(e.target) && 
                (!searchButton || !searchButton.querySelector('.fa-search'))) {
                searchPanel.classList.remove('active');
                searchDropdown.classList.remove('active');
            }
        });
        
        // Фильтрация аниме на главной странице
        function filterAnimes(filter) {
            currentFilter = filter;
            currentPage = 1;
            
            // Обновление активной кнопки
            document.querySelectorAll('#homePage .filter-btn').forEach(btn => {
                btn.classList.remove('active');
                btn.classList.add('secondary');
            });
            event.target.classList.add('active');
            event.target.classList.remove('secondary');
            
            // Загрузка аниме с новым фильтром
            loadPopularAnimes();
        }
        
        // Фильтрация аниме на странице всех аниме
        function filterAllAnimes(filter) {
            allAnimesCurrentFilter = filter;
            allAnimesCurrentPage = 1;
            
            // Обновление активной кнопки
            document.querySelectorAll('#allAnimesPage .filter-btn').forEach(btn => {
                btn.classList.remove('active');
                btn.classList.add('secondary');
            });
            event.target.classList.add('active');
            event.target.classList.remove('secondary');
            
            // Загрузка аниме с новым фильтром
            loadAllAnimes();
        }
        
        // Повторная попытка загрузки
        function retryLoading() {
            retryCount = 0;
            currentProxyIndex = 0;
            document.getElementById('errorMessage').classList.remove('show');
            loadPopularAnimes();
        }
        
        // Повторная попытка загрузки всех аниме
        function retryAllAnimesLoading() {
            retryCount = 0;
            currentProxyIndex = 0;
            document.getElementById('allAnimesErrorMessage').classList.remove('show');
            loadAllAnimes();
        }
        
        // Получение текущего прокси
        function getCurrentProxy() {
            const proxy = PROXY_SERVERS[currentProxyIndex];
            currentProxyIndex = (currentProxyIndex + 1) % PROXY_SERVERS.length;
            return proxy;
        }
        
        // Загрузка популярных аниме
        async function loadPopularAnimes() {
            const loader = document.getElementById('popularLoader');
            const grid = document.getElementById('popularAnimesGrid');
            const errorMessage = document.getElementById('errorMessage');
            
            // Показать индикатор загрузки
            loader.style.display = 'flex';
            grid.innerHTML = '';
            errorMessage.classList.remove('show');
            
            try {
                // Формирование URL запроса
                let apiUrl = `${API_BASE_URL}/animes?limit=50&page=${currentPage}&order=popularity`;
                
                // Добавление фильтров
                if (currentFilter === 'ongoing') {
                    apiUrl += '&status=ongoing';
                } else if (currentFilter === 'released') {
                    apiUrl += '&status=released';
                }
                
                // Попытка загрузки с разными прокси
                let data = null;
                let lastError = null;
                
                for (let i = 0; i < PROXY_SERVERS.length; i++) {
                    try {
                        const proxy = getCurrentProxy();
                        const url = `${proxy}${encodeURIComponent(apiUrl)}`;
                        
                        const response = await fetch(url, {
                            headers: {
                                'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36'
                            }
                        });
                        
                        if (response.ok) {
                            data = await response.json();
                            break;
                        }
                    } catch (error) {
                        lastError = error;
                        console.warn(`Прокси ${PROXY_SERVERS[i]} не сработал:`, error);
                    }
                }
                
                if (!data) {
                    throw lastError || new Error('Не удалось загрузить данные');
                }
                
                // Сохранение общего количества страниц
                if (Array.isArray(data)) {
                    totalPages = Math.ceil(data.length / 16);
                } else {
                    totalPages = 1;
                }
                
                // Отображение аниме
                renderAnimes(data.slice(0, 16), grid);
                
                // Обновление пагинации
                renderPagination();
                
                // Сброс счетчика повторных попыток
                retryCount = 0;
                
            } catch (error) {
                console.error('Ошибка при загрузке аниме:', error);
                
                retryCount++;
                if (retryCount < MAX_RETRIES) {
                    // Повторная попытка через 2 секунды
                    setTimeout(() => {
                        loadPopularAnimes();
                    }, 2000);
                } else {
                    errorMessage.classList.add('show');
                }
            } finally {
                // Скрыть индикатор загрузки
                loader.style.display = 'none';
            }
        }
        
        // Загрузка всех аниме
        async function loadAllAnimes() {
            const loader = document.getElementById('allAnimesLoader');
            const grid = document.getElementById('allAnimesGrid');
            const errorMessage = document.getElementById('allAnimesErrorMessage');
            
            // Показать индикатор загрузки
            loader.style.display = 'flex';
            grid.innerHTML = '';
            errorMessage.classList.remove('show');
            
            try {
                // Формирование URL запроса
                let apiUrl = `${API_BASE_URL}/animes?limit=50&page=${allAnimesCurrentPage}&order=popularity`;
                
                // Добавление фильтров
                if (allAnimesCurrentFilter === 'ongoing') {
                    apiUrl += '&status=ongoing';
                } else if (allAnimesCurrentFilter === 'released') {
                    apiUrl += '&status=released';
                }
                
                // Попытка загрузки с разными прокси
                let data = null;
                let lastError = null;
                
                for (let i = 0; i < PROXY_SERVERS.length; i++) {
                    try {
                        const proxy = getCurrentProxy();
                        const url = `${proxy}${encodeURIComponent(apiUrl)}`;
                        
                        const response = await fetch(url, {
                            headers: {
                                'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36'
                            }
                        });
                        
                        if (response.ok) {
                            data = await response.json();
                            break;
                        }
                    } catch (error) {
                        lastError = error;
                        console.warn(`Прокси ${PROXY_SERVERS[i]} не сработал:`, error);
                    }
                }
                
                if (!data) {
                    throw lastError || new Error('Не удалось загрузить данные');
                }
                
                // Сохранение общего количества страниц
                if (Array.isArray(data)) {
                    allAnimesTotalPages = Math.ceil(data.length / 12);
                } else {
                    allAnimesTotalPages = 1;
                }
                
                // Отображение аниме
                renderAnimes(data.slice(0, 12), grid);
                
                // Обновление пагинации
                renderAllAnimesPagination();
                
                // Сброс счетчика повторных попыток
                retryCount = 0;
                
            } catch (error) {
                console.error('Ошибка при загрузке всех аниме:', error);
                
                retryCount++;
                if (retryCount < MAX_RETRIES) {
                    // Повторная попытка через 2 секунды
                    setTimeout(() => {
                        loadAllAnimes();
                    }, 2000);
                } else {
                    errorMessage.classList.add('show');
                }
            } finally {
                // Скрыть индикатор загрузки
                loader.style.display = 'none';
            }
        }
        
        // Поиск аниме
        async function searchAnimes(searchTerm) {
            // Переход на страницу всех аниме с результатами поиска
            showAllAnimes();
            allAnimesCurrentFilter = 'all';
            allAnimesCurrentPage = 1;
            
            const loader = document.getElementById('allAnimesLoader');
            const grid = document.getElementById('allAnimesGrid');
            const pagination = document.getElementById('allAnimesPagination');
            const errorMessage = document.getElementById('allAnimesErrorMessage');
            
            // Показать индикатор загрузки
            loader.style.display = 'flex';
            grid.innerHTML = '';
            pagination.innerHTML = '';
            errorMessage.classList.remove('show');
            
            try {
                let apiUrl = `${API_BASE_URL}/animes?limit=50&search=${encodeURIComponent(searchTerm)}`;
                let data = null;
                
                // Попытка загрузки с разными прокси
                for (let i = 0; i < PROXY_SERVERS.length; i++) {
                    try {
                        const proxy = PROXY_SERVERS[i];
                        const url = `${proxy}${encodeURIComponent(apiUrl)}`;
                        
                        const response = await fetch(url, {
                            headers: {
                                'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36'
                            }
                        });
                        
                        if (response.ok) {
                            data = await response.json();
                            break;
                        }
                    } catch (error) {
                        console.warn(`Прокси ${PROXY_SERVERS[i]} не сработал:`, error);
                    }
                }
                
                if (data) {
                    // Отображение аниме
                    renderAnimes(data.slice(0, 12), grid);
                    
                    // Скрыть пагинацию для результатов поиска
                    pagination.innerHTML = '';
                } else {
                    throw new Error('Не удалось загрузить данные');
                }
                
            } catch (error) {
                console.error('Ошибка при поиске аниме:', error);
                errorMessage.classList.add('show');
                grid.innerHTML = '';
            } finally {
                // Скрыть индикатор загрузки
                loader.style.display = 'none';
            }
        }
        
        // Загрузка деталей аниме
        async function loadAnimeDetails(animeId) {
            try {
                let apiUrl = `${API_BASE_URL}/animes/${animeId}`;
                let anime = null;
                
                // Попытка загрузки с разными прокси
                for (let i = 0; i < PROXY_SERVERS.length; i++) {
                    try {
                        const proxy = PROXY_SERVERS[i];
                        const url = `${proxy}${encodeURIComponent(apiUrl)}`;
                        
                        const response = await fetch(url, {
                            headers: {
                                'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36'
                            }
                        });
                        
                        if (response.ok) {
                            anime = await response.json();
                            break;
                        }
                    } catch (error) {
                        console.warn(`Прокси ${PROXY_SERVERS[i]} не сработал:`, error);
                    }
                }
                
                if (anime) {
                    // Отображение деталей на странице
                    document.getElementById('animeDetailImage').src = anime.image ? `${SHIKIMORI_BASE_URL}${anime.image.original}` : 'https://picsum.photos/seed/anime-placeholder/400/600';
                    document.getElementById('animeDetailTitle').textContent = anime.russian || anime.name;
                    
                    // Информация
                    document.getElementById('animeDetailYear').textContent = anime.aired_on ? new Date(anime.aired_on).getFullYear() : 'N/A';
                    document.getElementById('animeDetailEpisodes').textContent = anime.episodes || anime.episodes_aired || 'N/A';
                    document.getElementById('animeDetailStatus').textContent = getStatusText(anime.status);
                    document.getElementById('animeDetailScore').textContent = anime.score || 'N/A';
                    
                    // Описание
                    document.getElementById('animeDetailDescription').textContent = anime.description || '';
                    
                    // Жанры
                    const genresContainer = document.getElementById('animeDetailGenres');
                    genresContainer.innerHTML = '';
                    
                    if (anime.genres && anime.genres.length > 0) {
                        anime.genres.forEach(genre => {
                            const genreElement = document.createElement('span');
                            genreElement.className = 'anime-detail-genre';
                            genreElement.textContent = genre.russian || genre.name;
                            genresContainer.appendChild(genreElement);
                        });
                    }
                    
                    // Студия
                    document.getElementById('animeDetailStudio').textContent = 
                        anime.studios && anime.studios.length > 0 ? anime.studios[0].name : 'N/A';
                    
                    // Загрузка скриншотов
                    loadAnimeScreenshots(animeId);
                    
                    // Обновление кнопок
                    document.querySelector('.anime-detail-actions .btn-primary').onclick = () => {
                        // Прокрутка к плеерам
                        document.querySelector('.anime-players').scrollIntoView({ behavior: 'smooth' });
                    };
                    
                    document.querySelector('.anime-detail-actions .btn-secondary').onclick = () => {
                        alert(`Добавлено в избранное: ${anime.russian || anime.name}`);
                    };
                } else {
                    throw new Error('Не удалось загрузить данные');
                }
                
            } catch (error) {
                console.error('Ошибка при загрузке деталей аниме:', error);
                document.getElementById('animeDetailTitle').textContent = 'Ошибка загрузки данных';
                document.getElementById('animeDetailDescription').textContent = 'Не удалось загрузить информацию об аниме.';
            }
        }
        
        // Загрузка скриншотов аниме
        async function loadAnimeScreenshots(animeId) {
            const screenshotsContainer = document.getElementById('animeDetailScreenshots');
            const indicatorsContainer = document.getElementById('screenshotIndicators');
            
            screenshotsContainer.innerHTML = '<div class="loader"><div class="spinner"></div></div>';
            indicatorsContainer.innerHTML = '';
            
            try {
                let apiUrl = `${API_BASE_URL}/animes/${animeId}/screenshots`;
                let screenshots = null;
                
                // Попытка загрузки с разными прокси
                for (let i = 0; i < PROXY_SERVERS.length; i++) {
                    try {
                        const proxy = PROXY_SERVERS[i];
                        const url = `${proxy}${encodeURIComponent(apiUrl)}`;
                        
                        const response = await fetch(url, {
                            headers: {
                                'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36'
                            }
                        });
                        
                        if (response.ok) {
                            screenshots = await response.json();
                            break;
                        }
                    } catch (error) {
                        console.warn(`Прокси ${PROXY_SERVERS[i]} не сработал:`, error);
                    }
                }
                
                screenshotsContainer.innerHTML = '';
                
                if (screenshots && screenshots.length > 0) {
                    // Разделяем скриншоты на группы по 4
                    const screenshotGroups = [];
                    for (let i = 0; i < screenshots.length; i += 4) {
                        screenshotGroups.push(screenshots.slice(i, i + 4));
                    }
                    
                    totalScreenshotGroups = screenshotGroups.length;
                    currentScreenshotIndex = 0;
                    
                    // Создаем слайды для каждой группы
                    screenshotGroups.forEach((group, groupIndex) => {
                        const slide = document.createElement('div');
                        slide.className = 'screenshot-slide';
                        
                        // Добавляем скриншоты в ряд 4x1
                        group.forEach((screenshot, index) => {
                            const img = document.createElement('img');
                            img.src = `${SHIKIMORI_BASE_URL}${screenshot.original}`;
                            img.alt = `Скриншот ${groupIndex * 4 + index + 1}`;
                            img.className = 'anime-detail-screenshot';
                            img.onerror = function() {
                                this.src = `https://picsum.photos/seed/screenshot-${groupIndex * 4 + index + 1}/400/300`;
                            };
                            slide.appendChild(img);
                        });
                        
                        // Если в последней группе меньше 4 скриншотов, добавляем пустые места
                        if (group.length < 4 && groupIndex === screenshotGroups.length - 1) {
                            for (let i = group.length; i < 4; i++) {
                                const placeholder = document.createElement('div');
                                placeholder.className = 'anime-detail-screenshot';
                                placeholder.style.backgroundColor = 'var(--bg-light)';
                                slide.appendChild(placeholder);
                            }
                        }
                        
                        screenshotsContainer.appendChild(slide);
                        
                        // Добавляем индикатор для группы
                        const indicator = document.createElement('div');
                        indicator.className = 'screenshot-indicator';
                        if (groupIndex === 0) {
                            indicator.classList.add('active');
                        }
                        indicator.onclick = () => goToScreenshot(groupIndex);
                        indicatorsContainer.appendChild(indicator);
                    });
                    
                    // Добавляем обработчики для свайпа
                    setupScreenshotSwipe();
                    
                    // Обновляем видимость кнопок
                    updateScreenshotButtons();
                } else {
                    // Если скриншоты не найдены, показываем одну группу с заглушками
                    const slide = document.createElement('div');
                    slide.className = 'screenshot-slide';
                    
                    for (let i = 0; i < 4; i++) {
                        const img = document.createElement('img');
                        img.src = `https://picsum.photos/seed/screenshot-${i + 1}/400/300`;
                        img.alt = `Скриншот ${i + 1}`;
                        img.className = 'anime-detail-screenshot';
                        slide.appendChild(img);
                    }
                    
                    screenshotsContainer.appendChild(slide);
                    
                    // Добавляем индикатор
                    const indicator = document.createElement('div');
                    indicator.className = 'screenshot-indicator active';
                    indicatorsContainer.appendChild(indicator);
                    
                    totalScreenshotGroups = 1;
                    currentScreenshotIndex = 0;
                    
                    // Скрываем кнопки навигации
                    updateScreenshotButtons();
                }
                
            } catch (error) {
                console.error('Ошибка при загрузке скриншотов:', error);
                screenshotsContainer.innerHTML = '';
                
                // В случае ошибки показываем одну группу с заглушками
                const slide = document.createElement('div');
                slide.className = 'screenshot-slide';
                
                for (let i = 0; i < 4; i++) {
                    const img = document.createElement('img');
                    img.src = `https://picsum.photos/seed/screenshot-${i + 1}/400/300`;
                    img.alt = `Скриншот ${i + 1}`;
                    img.className = 'anime-detail-screenshot';
                    slide.appendChild(img);
                }
                
                screenshotsContainer.appendChild(slide);
                
                // Добавляем индикатор
                const indicator = document.createElement('div');
                indicator.className = 'screenshot-indicator active';
                indicatorsContainer.appendChild(indicator);
                
                totalScreenshotGroups = 1;
                currentScreenshotIndex = 0;
                
                // Скрываем кнопки навигации
                updateScreenshotButtons();
            }
        }
        
        // Настройка свайпа для скриншотов
        function setupScreenshotSwipe() {
            const container = document.querySelector('.anime-detail-screenshots-container');
            
            container.addEventListener('mousedown', (e) => {
                isDragging = true;
                startX = e.clientX;
                currentX = startX;
                container.style.cursor = 'grabbing';
            });
            
            container.addEventListener('mousemove', (e) => {
                if (!isDragging) return;
                currentX = e.clientX;
            });
            
            container.addEventListener('mouseup', (e) => {
                if (!isDragging) return;
                isDragging = false;
                container.style.cursor = 'grab';
                
                const diff = startX - e.clientX;
                const threshold = 50; // Порог для свайпа
                
                if (Math.abs(diff) > threshold) {
                    if (diff > 0) {
                        // Свайп влево - следующая группа
                        changeScreenshot(1);
                    } else {
                        // Свайп вправо - предыдущая группа
                        changeScreenshot(-1);
                    }
                }
            });
            
            container.addEventListener('mouseleave', () => {
                isDragging = false;
                container.style.cursor = 'grab';
            });
        }
        
        // Переключение группы скриншотов
        function changeScreenshot(direction) {
            if (totalScreenshotGroups <= 1) return;
            
            currentScreenshotIndex += direction;
            
            // Зацикливание
            if (currentScreenshotIndex < 0) {
                currentScreenshotIndex = totalScreenshotGroups - 1;
            } else if (currentScreenshotIndex >= totalScreenshotGroups) {
                currentScreenshotIndex = 0;
            }
            
            updateScreenshotDisplay();
            updateScreenshotButtons();
        }
        
        // Переход к конкретной группе скриншотов
        function goToScreenshot(index) {
            if (index < 0 || index >= totalScreenshotGroups) return;
            
            currentScreenshotIndex = index;
            updateScreenshotDisplay();
            updateScreenshotButtons();
        }
        
        // Обновление отображения группы скриншотов
        function updateScreenshotDisplay() {
            const container = document.getElementById('animeDetailScreenshots');
            container.style.transform = `translateX(-${currentScreenshotIndex * 100}%)`;
            
            // Обновление индикаторов
            const indicators = document.querySelectorAll('.screenshot-indicator');
            indicators.forEach((indicator, index) => {
                if (index === currentScreenshotIndex) {
                    indicator.classList.add('active');
                } else {
                    indicator.classList.remove('active');
                }
            });
        }
        
        // Обновление видимости кнопок
        function updateScreenshotButtons() {
            const prevBtn = document.querySelector('.screenshot-nav.prev');
            const nextBtn = document.querySelector('.screenshot-nav.next');
            
            if (totalScreenshotGroups <= 1) {
                prevBtn.style.display = 'none';
                nextBtn.style.display = 'none';
            } else {
                prevBtn.style.display = 'block';
                nextBtn.style.display = 'block';
            }
        }
        
        // Переключение плеера
        function switchPlayer(playerType) {
            // Обновление активной вкладки
            document.querySelectorAll('.player-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Обновление активного плеера
            document.querySelectorAll('.player-frame').forEach(frame => {
                frame.classList.remove('active');
            });
            document.getElementById(`${playerType}-player`).classList.add('active');
        }
        
        // Инициализация плеера Kodik
        function initKodikPlayer() {
            const playerContainer = document.getElementById('kodik-player');
            
            // Очищаем контейнер
            playerContainer.innerHTML = `
                <div class="loader">
                    <div class="spinner"></div>
                </div>
            `;
            
            // Имитация загрузки плеера
            setTimeout(() => {
                playerContainer.innerHTML = `
                    <div class="player-placeholder">
                        <i class="fas fa-check-circle player-placeholder-icon" style="color: #10b981;"></i>
                        <h3 class="player-placeholder-title">Kodik Player инициализирован</h3>
                        <p class="player-placeholder-description">
                            Плеер готов к воспроизведению аниме с ID: ${currentAnimeId}
                        </p>
                        <div class="player-token">Токен: ${KodikToken}</div>
                        <div style="background-color: var(--bg-light); width: 100%; height: 200px; border-radius: 0.5rem; display: flex; align-items: center; justify-content: center; margin-top: 1rem;">
                            <i class="fas fa-play-circle" style="font-size: 3rem; color: var(--primary-color);"></i>
                        </div>
                    </div>
                `;
            }, 1500);
        }
        
        // Инициализация плеера Alloha
        function initAllohaPlayer() {
            const playerContainer = document.getElementById('alloha-player');
            
            // Очищаем контейнер
            playerContainer.innerHTML = `
                <div class="loader">
                    <div class="spinner"></div>
                </div>
            `;
            
            // Имитация загрузки плеера
            setTimeout(() => {
                playerContainer.innerHTML = `
                    <div class="player-placeholder">
                        <i class="fas fa-check-circle player-placeholder-icon" style="color: #10b981;"></i>
                        <h3 class="player-placeholder-title">Alloha Player инициализирован</h3>
                        <p class="player-placeholder-description">
                            Плеер готов к воспроизведению аниме с ID: ${currentAnimeId}
                        </p>
                        <div class="player-token">Токен: ${AllohaToken}</div>
                        <div style="background-color: var(--bg-light); width: 100%; height: 200px; border-radius: 0.5rem; display: flex; align-items: center; justify-content: center; margin-top: 1rem;">
                            <i class="fas fa-play-circle" style="font-size: 3rem; color: var(--primary-color);"></i>
                        </div>
                    </div>
                `;
            }, 1500);
        }
        
        // Отображение аниме
        function renderAnimes(animes, container) {
            container.innerHTML = '';
            
            if (!animes || animes.length === 0) {
                container.innerHTML = '<p>Аниме не найдены.</p>';
                return;
            }
            
            animes.forEach(anime => {
                const card = document.createElement('div');
                card.className = 'popular-card';
                card.onclick = () => showAnimeDetail(anime.id);
                
                // Создание HTML для карточки
                const imageUrl = anime.image ? `${SHIKIMORI_BASE_URL}${anime.image.original}` : 'https://picsum.photos/seed/anime-placeholder/400/600';
                
                // Формируем теги жанров только если они есть
                let genreTagsHtml = '';
                if (anime.genres && anime.genres.length > 0) {
                    genreTagsHtml = anime.genres.slice(0, 2).map(genre => 
                        `<span class="genre-tag">${genre.russian || genre.name}</span>`
                    ).join('');
                }
                
                // Формируем описание только если оно есть
                let descriptionHtml = '';
                if (anime.description) {
                    descriptionHtml = `<p class="popular-card-description">${truncateText(anime.description, 100)}</p>`;
                }
                
                card.innerHTML = `
                    <div class="popular-card-image">
                        <img src="${imageUrl}" alt="${anime.russian || anime.name}" onerror="this.src='https://picsum.photos/seed/anime-error/400/600'">
                        <div class="play-overlay">
                            <i class="fas fa-play-circle play-icon"></i>
                        </div>
                        <div class="rating-badge">${anime.score || 'N/A'}</div>
                    </div>
                    <div class="popular-card-content">
                        <h3 class="popular-card-title">${anime.russian || anime.name}</h3>
                        <div class="genre-tags">
                            ${genreTagsHtml}
                        </div>
                        ${descriptionHtml}
                    </div>
                `;
                
                container.appendChild(card);
            });
        }
        
        // Отображение пагинации для популярных аниме
        function renderPagination() {
            const pagination = document.getElementById('pagination');
            pagination.innerHTML = '';
            
            // Кнопка "Назад"
            const prevBtn = document.createElement('button');
            prevBtn.className = 'pagination-btn';
            prevBtn.textContent = '←';
            prevBtn.disabled = currentPage === 1;
            prevBtn.onclick = () => {
                if (currentPage > 1) {
                    currentPage--;
                    loadPopularAnimes();
                }
            };
            pagination.appendChild(prevBtn);
            
            // Номера страниц
            const maxVisiblePages = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
            
            if (endPage - startPage + 1 < maxVisiblePages) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }
            
            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = 'pagination-btn';
                if (i === currentPage) {
                    pageBtn.classList.add('active');
                }
                pageBtn.textContent = i;
                pageBtn.onclick = () => {
                    currentPage = i;
                    loadPopularAnimes();
                };
                pagination.appendChild(pageBtn);
            }
            
            // Кнопка "Вперед"
            const nextBtn = document.createElement('button');
            nextBtn.className = 'pagination-btn';
            nextBtn.textContent = '→';
            nextBtn.disabled = currentPage === totalPages;
            nextBtn.onclick = () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    loadPopularAnimes();
                }
            };
            pagination.appendChild(nextBtn);
        }
        
        // Отображение пагинации для всех аниме
        function renderAllAnimesPagination() {
            const pagination = document.getElementById('allAnimesPagination');
            pagination.innerHTML = '';
            
            // Кнопка "Назад"
            const prevBtn = document.createElement('button');
            prevBtn.className = 'pagination-btn';
            prevBtn.textContent = '←';
            prevBtn.disabled = allAnimesCurrentPage === 1;
            prevBtn.onclick = () => {
                if (allAnimesCurrentPage > 1) {
                    allAnimesCurrentPage--;
                    loadAllAnimes();
                }
            };
            pagination.appendChild(prevBtn);
            
            // Номера страниц
            const maxVisiblePages = 5;
            let startPage = Math.max(1, allAnimesCurrentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(allAnimesTotalPages, startPage + maxVisiblePages - 1);
            
            if (endPage - startPage + 1 < maxVisiblePages) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }
            
            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = 'pagination-btn';
                if (i === allAnimesCurrentPage) {
                    pageBtn.classList.add('active');
                }
                pageBtn.textContent = i;
                pageBtn.onclick = () => {
                    allAnimesCurrentPage = i;
                    loadAllAnimes();
                };
                pagination.appendChild(pageBtn);
            }
            
            // Кнопка "Вперед"
            const nextBtn = document.createElement('button');
            nextBtn.className = 'pagination-btn';
            nextBtn.textContent = '→';
            nextBtn.disabled = allAnimesCurrentPage === allAnimesTotalPages;
            nextBtn.onclick = () => {
                if (allAnimesCurrentPage < allAnimesTotalPages) {
                    allAnimesCurrentPage++;
                    loadAllAnimes();
                }
            };
            pagination.appendChild(nextBtn);
        }
        
        // Вспомогательные функции
        function truncateText(text, maxLength) {
            if (text.length <= maxLength) return text;
            return text.substr(0, maxLength) + '...';
        }
        
        function getStatusText(status) {
            switch (status) {
                case 'anons': return 'Анонс';
                case 'ongoing': return 'Онгоинг';
                case 'released': return 'Завершено';
                default: return status;
            }
        }
        
        // Анимация при прокрутке
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };
        
        const observer = new IntersectionObserver(function(entries) {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('fade-in');
                }
            });
        }, observerOptions);
        
        // Наблюдаем за всеми секциями
        document.querySelectorAll('section').forEach(section => {
            observer.observe(section);
        });
        
        // Обработка отправки формы поиска
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                performSearch();
            }
        });
        
        // Инициализация при загрузке страницы
        document.addEventListener('DOMContentLoaded', function() {
            // Загрузка популярных аниме
            loadPopularAnimes();
        });
    </script>
</body>
</html>
